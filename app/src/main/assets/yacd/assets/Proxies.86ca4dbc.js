import{r as g,j as n,P as $,c as w,T as ve,b as c,B as b,h as f,U as _e,V as xe,W as ee,X as te,d as C,Y as ge,F as T,Z as be,$ as re,a0 as M,w as D,a1 as we,a2 as ne,a3 as O,a4 as oe,a5 as H,a6 as U,a7 as Ce,a8 as ke,u as q,a9 as Pe,aa as Se,ab as Ne,g as se,C as ae,x as V,ac as $e,m as W,M as Ae,ad as Le,ae as Oe,af as Te,ag as De}from"./index.5b186934.js";import{C as Be}from"./chevron-down.a948e720.js";import{F as Ie,p as Fe,A as je,I as Re}from"./Fab.79155072.js";import{R as ze,a as Me,T as He}from"./TextFitler.a1d2aef6.js";import{f as Ue}from"./index.afdc8976.js";import{S as qe}from"./Select.4e6ef66c.js";import"./debounce.76599460.js";function Ee(e,t){if(e==null)return{};var r=Ke(e,t),o,s;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(s=0;s<a.length;s++)o=a[s],!(t.indexOf(o)>=0)&&(!Object.prototype.propertyIsEnumerable.call(e,o)||(r[o]=e[o]))}return r}function Ke(e,t){if(e==null)return{};var r={},o=Object.keys(e),s,a;for(a=0;a<o.length;a++)s=o[a],!(t.indexOf(s)>=0)&&(r[s]=e[s]);return r}var E=g.exports.forwardRef(function(e,t){var r=e.color,o=r===void 0?"currentColor":r,s=e.size,a=s===void 0?24:s,l=Ee(e,["color","size"]);return n("svg",{ref:t,xmlns:"http://www.w3.org/2000/svg",width:a,height:a,viewBox:"0 0 24 24",fill:"none",stroke:o,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",...l,children:n("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})});E.propTypes={color:$.string,size:$.oneOfType([$.string,$.number])};E.displayName="Zap";var Z=E;function le(e){const t=e.size||24,r=w({[ve.animate]:e.animate});return n("svg",{className:r,xmlns:"http://www.w3.org/2000/svg",width:t,height:t,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:n("polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2"})})}const Ve="_FlexCenter_1380a_1";var We={FlexCenter:Ve};function Ze({children:e}){return n("div",{className:We.FlexCenter,children:e})}const{useRef:G,useEffect:Ge}=f;function Ye({onClickPrimaryButton:e,onClickSecondaryButton:t}){const r=G(null),o=G(null);return Ge(()=>{r.current.focus()},[]),c("div",{onKeyDown:a=>{a.keyCode===39?o.current.focus():a.keyCode===37&&r.current.focus()},children:[n("h2",{children:"Close Connections?"}),n("p",{children:'Click "Yes" to close those connections that are still using the old selected proxy in this group'}),n("div",{style:{height:30}}),c(Ze,{children:[n(b,{onClick:e,ref:r,children:"Yes"}),n("div",{style:{width:20}}),n(b,{onClick:t,ref:o,children:"No"})]})]})}const Xe="_header_1y9js_1",Je="_arrow_1y9js_8",Qe="_isOpen_1y9js_13",et="_btn_1y9js_20",tt="_qty_1y9js_25";var k={header:Xe,arrow:Je,isOpen:Qe,btn:et,qty:tt};function ie({name:e,type:t,toggle:r,isOpen:o,qty:s}){const a=g.exports.useCallback(l=>{l.preventDefault(),(l.key==="Enter"||l.key===" ")&&r()},[r]);return c("div",{className:k.header,onClick:r,style:{cursor:"pointer"},tabIndex:0,onKeyDown:a,role:"button",children:[n("div",{children:n(_e,{name:e,type:t})}),typeof s=="number"?n("span",{className:k.qty,children:s}):null,n(b,{kind:"minimal",onClick:r,className:k.btn,title:"Toggle collapsible section",children:n("span",{className:w(k.arrow,{[k.isOpen]:o}),children:n(Be,{size:20})})})]})}const{useMemo:rt}=f;function nt(e,t){return e.filter(r=>{const o=t[r];return o===void 0?!0:o.number!==0})}const A=(e,t)=>{if(e&&typeof e.number=="number"&&e.number>0)return e.number;const r=t&&t.type;return r&&te.indexOf(r)>-1?-1:999999},ot={Natural:e=>e,LatencyAsc:(e,t,r)=>e.sort((o,s)=>{const a=A(t[o],r&&r[o]),l=A(t[s],r&&r[s]);return a-l}),LatencyDesc:(e,t,r)=>e.sort((o,s)=>{const a=A(t[o],r&&r[o]);return A(t[s],r&&r[s])-a}),NameAsc:e=>e.sort(),NameDesc:e=>e.sort((t,r)=>t>r?-1:t<r?1:0)};function st(e,t){const r=t.toLowerCase().split(" ").map(o=>o.trim()).filter(o=>!!o);return r.length===0?e:e.filter(o=>{let s=0;for(;s<r.length;s++){const a=r[s];if(o.toLowerCase().indexOf(a)>-1)return!0}return!1})}function at(e,t,r,o,s,a){let l=[...e];return r&&(l=nt(e,t)),typeof o=="string"&&o!==""&&(l=st(l,o)),ot[s](l,t,a)}function ce(e,t,r,o,s){const[a]=xe(ee);return rt(()=>at(e,t,r,a,o,s),[e,t,r,a,o,s])}const lt="_header_5pmv2_1",it="_groupHead_5pmv2_5",ct="_action_5pmv2_11";var F={header:lt,groupHead:it,action:ct};const ut="_proxy_8ev0l_1",dt="_now_8ev0l_25",pt="_error_8ev0l_29",ht="_selectable_8ev0l_32",yt="_proxyType_8ev0l_40",ft="_row_8ev0l_51",mt="_proxyName_8ev0l_57",vt="_proxySmall_8ev0l_66";var m={proxy:ut,now:dt,error:pt,selectable:ht,proxyType:yt,row:ft,proxyName:mt,proxySmall:vt};const _t="_proxyLatency_hz69v_1";var xt={proxyLatency:_t};function gt({number:e,color:t}){return n("span",{className:xt.proxyLatency,style:{color:t},children:typeof e=="number"&&e!==0?e+" ms":" "})}const{useMemo:N}=f,P={good:"#67c23a",normal:"#d4b75c",bad:"#e67f3c",na:"#909399"};function ue({number:e}={}){return e===0?P.na:e<200?P.good:e<400?P.normal:typeof e=="number"?P.bad:P.na}function bt(e,t){return te.indexOf(t)>-1?{border:"1px dotted #777"}:{background:ue(e)}}function wt({now:e,name:t,proxy:r,latency:o,isSelectable:s,onClick:a}){const l=N(()=>bt(o,r.type),[o,r]),i=N(()=>{let d=t;return o&&typeof o.number=="number"&&(d+=" "+o.number+" ms"),d},[t,o]),u=g.exports.useCallback(()=>{s&&a&&a(t)},[t,a,s]),p=N(()=>w(m.proxySmall,{[m.now]:e,[m.selectable]:s}),[s,e]),h=g.exports.useCallback(d=>{d.key==="Enter"&&u()},[u]);return n("div",{title:i,className:p,style:l,onClick:u,onKeyDown:h,role:s?"menuitem":""})}function Ct(e){return e==="Shadowsocks"?"SS":e}const kt=e=>({left:e.left+window.scrollX-5,top:e.top+window.scrollY-38});function Pt({children:e,label:t,"aria-label":r}){const[o,s]=ge();return c(T,{children:[g.exports.cloneElement(e,o),n(be,{...s,label:t,"aria-label":r,position:kt})]})}function St({now:e,name:t,proxy:r,latency:o,isSelectable:s,onClick:a}){const l=N(()=>ue(o),[o]),i=g.exports.useCallback(()=>{s&&a&&a(t)},[t,a,s]),u=g.exports.useCallback(h=>{h.key==="Enter"&&i()},[i]),p=N(()=>w(m.proxy,{[m.now]:e,[m.selectable]:s}),[s,e]);return c("div",{tabIndex:0,className:p,onClick:i,onKeyDown:u,role:s?"menuitem":"",children:[n("div",{className:m.proxyName,children:n(Pt,{label:t,"aria-label":"proxy name: "+t,children:n("span",{children:t})})}),c("div",{className:m.row,children:[n("span",{className:m.proxyType,style:{opacity:e?.6:.2},children:Ct(r.type)}),n(gt,{number:o==null?void 0:o.number,color:l})]})]})}const de=(e,{name:t})=>{const r=re(e),o=M(e);return{proxy:r[t]||{name:t,type:"Unknown",history:[]},latency:o[t]}},Nt=C(de)(St),$t=C(de)(wt),At="_list_1oy7w_1",Lt="_listSummaryView_1oy7w_8";var pe={list:At,listSummaryView:Lt};function he({all:e,now:t,isSelectable:r,itemOnTapCallback:o}){const s=e;return n("div",{className:pe.list,children:s.map(a=>n(Nt,{onClick:o,isSelectable:r,name:a,now:a===t},a))})}function ye({all:e,now:t,isSelectable:r,itemOnTapCallback:o}){return n("div",{className:pe.listSummaryView,children:e.map(s=>n($t,{onClick:o,isSelectable:r,name:s,now:s===t},s))})}const{createElement:Ot,useCallback:j,useMemo:Tt}=f;function Dt({name:e,all:t,delay:r,hideUnavailableProxies:o,proxySortBy:s,proxies:a,type:l,now:i,isOpen:u,apiConfig:p,dispatch:h}){const d=ce(t,r,o,s,a),_=Tt(()=>l==="Selector",[l]),{app:{updateCollapsibleIsOpen:x},proxies:{requestDelayForProxies:y}}=D(),B=j(()=>{x("proxyGroup",e,!u)},[u,x,e]),I=j(K=>{!_||h(we(p,e,K))},[p,h,e,_]),v=ne(!1),me=j(async()=>{if(!v.value){v.set(!0);try{await y(p,d)}catch{}v.set(!1)}},[d,p,y,v]);return c("div",{className:F.group,children:[c("div",{className:F.groupHead,children:[n(ie,{name:e,type:l,toggle:B,qty:d.length,isOpen:u}),n("div",{className:F.action,children:n(O,{label:"Test latency",children:n(b,{kind:"circular",onClick:me,children:n(le,{animate:v.value,size:16})})})})]}),Ot(u?he:ye,{all:d,now:i,isSelectable:_,itemOnTapCallback:I})]})}const Bt=C((e,{name:t,delay:r})=>{const o=re(e),s=oe(e),a=H(e),l=U(e),i=o[t],{all:u,type:p,now:h}=i;return{all:u,delay:r,hideUnavailableProxies:l,proxySortBy:a,proxies:o,type:p,now:h,isOpen:s[`proxyGroup:${t}`]}})(Dt),{useCallback:fe,useState:It}=f;function Ft({dispatch:e,apiConfig:t,name:r}){return fe(()=>e(Ce(t,r)),[t,e,r])}function jt({dispatch:e,apiConfig:t,names:r}){const[o,s]=It(!1);return[fe(async()=>{if(!o){s(!0);try{await e(ke(t,r))}catch{}s(!1)}},[t,e,r,o]),o]}const{useState:Rt,useCallback:zt}=f;function Mt({isLoading:e}){return e?n(Re,{children:n(Z,{width:16,height:16})}):n(Z,{width:16,height:16})}function Ht({dispatch:e,apiConfig:t}){const[r,o]=Rt(!1);return[zt(()=>{r||(o(!0),e(Pe(t)).then(()=>o(!1),()=>o(!1)))},[t,e,r]),r]}function Ut({dispatch:e,apiConfig:t,proxyProviders:r}){const{t:o}=q(),[s,a]=Ht({dispatch:e,apiConfig:t}),[l,i]=jt({apiConfig:t,dispatch:e,names:r.map(u=>u.name)});return n(Ie,{icon:n(Mt,{isLoading:a}),onClick:s,text:o("Test Latency"),style:Fe,children:r.length>0?n(je,{text:o("update_all_proxy_provider"),onClick:l,children:n(ze,{isRotating:i})}):null})}const qt="_updatedAt_1rx92_1",Et="_main_1rx92_8",Kt="_head_1rx92_17",Vt="_action_1rx92_23",Wt="_refresh_1rx92_31";var S={updatedAt:qt,main:Et,head:Kt,action:Vt,refresh:Wt};const{useCallback:Y}=f;function Zt({name:e,proxies:t,delay:r,hideUnavailableProxies:o,proxySortBy:s,vehicleType:a,updatedAt:l,isOpen:i,dispatch:u,apiConfig:p}){const h=ce(t,r,o,s),d=ne(!1),_=Ft({dispatch:u,apiConfig:p,name:e}),x=Y(()=>{if(d.value)return;d.set(!0);const v=()=>d.set(!1);u(Se(p,e)).then(v,v)},[p,u,e,d]),{app:{updateCollapsibleIsOpen:y}}=D(),B=Y(()=>{y("proxyProvider",e,!i)},[i,y,e]),I=Ue(new Date(l),new Date);return c("div",{className:S.main,children:[c("div",{className:S.head,children:[n(ie,{name:e,toggle:B,type:a,isOpen:i,qty:h.length}),c("div",{className:S.action,children:[n(O,{label:"Update",children:n(b,{kind:"circular",onClick:_,children:n(Xt,{})})}),n(O,{label:"Health Check",children:n(b,{kind:"circular",onClick:x,children:n(le,{animate:d.value,size:16})})})]})]}),n("div",{className:S.updatedAt,children:c("small",{children:["Updated ",I," ago"]})}),i?n(he,{all:h}):n(ye,{all:h})]})}const Gt={rest:{scale:1},pressed:{scale:.95}},Yt={rest:{rotate:0},hover:{rotate:360,transition:{duration:.3}}};function Xt(){const t=Ne.read().motion;return n(t.div,{className:S.refresh,variants:Gt,initial:"rest",whileHover:"hover",whileTap:"pressed",children:n(t.div,{className:"flexCenter",variants:Yt,children:n(Me,{size:16})})})}const Jt=(e,{proxies:t,name:r})=>{const o=U(e),s=M(e),a=oe(e),l=se(e),i=H(e);return{apiConfig:l,proxies:t,delay:s,hideUnavailableProxies:o,proxySortBy:i,isOpen:a[`proxyProvider:${r}`]}},Qt=C(Jt)(Zt);function er({items:e}){return e.length===0?null:c(T,{children:[n(ae,{title:"Proxy Provider"}),n("div",{children:e.map(t=>n(Qt,{name:t.name,proxies:t.proxies,type:t.type,vehicleType:t.vehicleType,updatedAt:t.updatedAt},t.name))})]})}const tr="_labeledInput_cmki0_1";var R={labeledInput:tr};const rr=[["Natural","order_natural"],["LatencyAsc","order_latency_asc"],["LatencyDesc","order_latency_desc"],["NameAsc","order_name_asc"],["NameDesc","order_name_desc"]],{useCallback:X}=f;function nr({appConfig:e}){const{app:{updateAppConfig:t}}=D(),r=X(a=>{t("proxySortBy",a.target.value)},[t]),o=X(a=>{t("hideUnavailableProxies",a)},[t]),{t:s}=q();return c(T,{children:[c("div",{className:R.labeledInput,children:[n("span",{children:s("sort_in_grp")}),n("div",{children:n(qe,{options:rr.map(a=>[a[0],s(a[1])]),selected:e.proxySortBy,onChange:r})})]}),n("hr",{}),c("div",{className:R.labeledInput,children:[n("span",{children:s("hide_unavail_proxies")}),n("div",{children:n(V,{name:"hideUnavailableProxies",checked:e.hideUnavailableProxies,onChange:o})})]}),c("div",{className:R.labeledInput,children:[n("span",{children:s("auto_close_conns")}),n("div",{children:n(V,{name:"autoCloseOldConns",checked:e.autoCloseOldConns,onChange:a=>t("autoCloseOldConns",a)})})]})]})}const or=e=>{const t=H(e),r=U(e),o=$e(e);return{appConfig:{proxySortBy:t,hideUnavailableProxies:r,autoCloseOldConns:o}}};var sr=C(or)(nr);const ar="_overlay_uuk3b_1",lr="_cnt_uuk3b_5",ir="_afterOpen_uuk3b_16";var z={overlay:ar,cnt:lr,afterOpen:ir};const{useMemo:cr}=f;function J({isOpen:e,onRequestClose:t,children:r}){const o=cr(()=>({base:w(W.content,z.cnt),afterOpen:z.afterOpen,beforeClose:""}),[]);return n(Ae,{isOpen:e,onRequestClose:t,className:o,overlayClassName:w(W.overlay,z.overlay),children:r})}function ur({color:e="currentColor",size:t=24}){return c("svg",{fill:"none",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",width:t,height:t,stroke:e,strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[n("path",{d:"M2 6h9M18.5 6H22"}),n("circle",{cx:"16",cy:"6",r:"2"}),n("path",{d:"M22 18h-9M6 18H2"}),n("circle",{r:"2",transform:"matrix(-1 0 0 1 8 18)"})]})}const dr="_topBar_jgy4z_1",pr="_topBarRight_jgy4z_13",hr="_textFilterContainer_jgy4z_22",yr="_group_jgy4z_29";var L={topBar:dr,topBarRight:pr,textFilterContainer:hr,group:yr};const{useState:fr,useEffect:mr,useCallback:Q,useRef:vr}=f;function _r({dispatch:e,groupNames:t,delay:r,proxyProviders:o,apiConfig:s,showModalClosePrevConns:a}){const l=vr({}),i=Q(()=>{l.current.startAt=Date.now(),e(Le(s)).then(()=>{l.current.completeAt=Date.now()})},[s,e]);mr(()=>{i();const y=()=>{l.current.startAt&&Date.now()-l.current.startAt>3e4&&i()};return window.addEventListener("focus",y,!1),()=>window.removeEventListener("focus",y,!1)},[i]);const[u,p]=fr(!1),h=Q(()=>{p(!1)},[]),{proxies:{closeModalClosePrevConns:d,closePrevConnsAndTheModal:_}}=D(),{t:x}=q();return c(T,{children:[n(J,{isOpen:u,onRequestClose:h,children:n(sr,{})}),c("div",{className:L.topBar,children:[n(ae,{title:x("Proxies")}),c("div",{className:L.topBarRight,children:[n("div",{className:L.textFilterContainer,children:n(He,{textAtom:ee})}),n(O,{label:x("settings"),children:n(b,{kind:"minimal",onClick:()=>p(!0),children:n(ur,{size:16})})})]})]}),n("div",{children:t.map(y=>n("div",{className:L.group,children:n(Bt,{name:y,delay:r,apiConfig:s,dispatch:e})},y))}),n(er,{items:o}),n("div",{style:{height:60}}),n(Ut,{dispatch:e,apiConfig:s,proxyProviders:o}),n(J,{isOpen:a,onRequestClose:d,children:n(Ye,{onClickPrimaryButton:()=>_(s),onClickSecondaryButton:d})})]})}const xr=e=>({apiConfig:se(e),groupNames:Oe(e),proxyProviders:Te(e),delay:M(e),showModalClosePrevConns:De(e)});var Nr=C(xr)(_r);export{Nr as default};
