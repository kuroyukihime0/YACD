import{_ as k,Q as _,ah as B,ai as w,aj as T,R as h,ak as U,al as g,am as A,an as $,D as b,ao as F,ap as O,V as L,b as c,j as o,U as q,B as D,u as I,d as Q,g as j,C as z,h as V}from"./index.5b186934.js";import{a as W,V as H}from"./index.esm.1963564c.js";import{R as C,T as G}from"./TextFitler.a1d2aef6.js";import{f as J}from"./index.afdc8976.js";import{F as K,p as X}from"./Fab.79155072.js";import{u as Y}from"./useRemainingViewPortHeight.a3932951.js";import"./debounce.76599460.js";var Z=function(r){k(i,r);function i(s,t){var e;return e=r.call(this)||this,e.client=s,e.setOptions(t),e.bindMethods(),e.updateResult(),e}var n=i.prototype;return n.bindMethods=function(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)},n.setOptions=function(t){this.options=this.client.defaultMutationOptions(t)},n.onUnsubscribe=function(){if(!this.listeners.length){var t;(t=this.currentMutation)==null||t.removeObserver(this)}},n.onMutationUpdate=function(t){this.updateResult();var e={listeners:!0};t.type==="success"?e.onSuccess=!0:t.type==="error"&&(e.onError=!0),this.notify(e)},n.getCurrentResult=function(){return this.currentResult},n.reset=function(){this.currentMutation=void 0,this.updateResult(),this.notify({listeners:!0})},n.mutate=function(t,e){return this.mutateOptions=e,this.currentMutation&&this.currentMutation.removeObserver(this),this.currentMutation=this.client.getMutationCache().build(this.client,_({},this.options,{variables:typeof t!="undefined"?t:this.options.variables})),this.currentMutation.addObserver(this),this.currentMutation.execute()},n.updateResult=function(){var t=this.currentMutation?this.currentMutation.state:B(),e=_({},t,{isLoading:t.status==="loading",isSuccess:t.status==="success",isError:t.status==="error",isIdle:t.status==="idle",mutate:this.mutate,reset:this.reset});this.currentResult=e},n.notify=function(t){var e=this;w.batch(function(){e.mutateOptions&&(t.onSuccess?(e.mutateOptions.onSuccess==null||e.mutateOptions.onSuccess(e.currentResult.data,e.currentResult.variables,e.currentResult.context),e.mutateOptions.onSettled==null||e.mutateOptions.onSettled(e.currentResult.data,null,e.currentResult.variables,e.currentResult.context)):t.onError&&(e.mutateOptions.onError==null||e.mutateOptions.onError(e.currentResult.error,e.currentResult.variables,e.currentResult.context),e.mutateOptions.onSettled==null||e.mutateOptions.onSettled(void 0,e.currentResult.error,e.currentResult.variables,e.currentResult.context))),t.listeners&&e.listeners.forEach(function(a){a(e.currentResult)})})},i}(T);function M(r,i,n){var s=h.useRef(!1),t=h.useState(0),e=t[1],a=U(r,i,n),d=g(),u=h.useRef();u.current?u.current.setOptions(a):u.current=new Z(d,a);var l=u.current.getCurrentResult();h.useEffect(function(){s.current=!0;var p=u.current.subscribe(w.batchCalls(function(){s.current&&e(function(R){return R+1})}));return function(){s.current=!1,p()}},[]);var v=h.useCallback(function(p,R){u.current.mutate(p,R).catch(A)},[]);if(l.error&&$(void 0,u.current.options.useErrorBoundary,[l.error]))throw l.error;return _({},l,{mutate:v,mutateAsync:l.mutate})}function ee(r){const i=r.providers,n=Object.keys(i),s={};for(let t=0;t<n.length;t++){const e=n[t];s[e]={...i[e],idx:t}}return{byName:s,names:n}}async function te(r,i){const{url:n,init:s}=b(i);let t={providers:{}};try{const e=await fetch(n+r,s);e.ok&&(t=await e.json())}catch(e){console.log("failed to GET /providers/rules",e)}return ee(t)}async function S({name:r,apiConfig:i}){const{url:n,init:s}=b(i);try{return(await fetch(n+`/providers/rules/${r}`,{method:"PUT",...s})).ok}catch(t){return console.log("failed to PUT /providers/rules/:name",t),!1}}async function re({names:r,apiConfig:i}){for(let n=0;n<r.length;n++)await S({name:r[n],apiConfig:i})}var ne=function(r,i,n,s,t,e,a,d){if(!r){var u;if(i===void 0)u=new Error("Minified exception occurred; use the non-minified dev environment for the full error message and additional helpful warnings.");else{var l=[n,s,t,e,a,d],v=0;u=new Error(i.replace(/%s/g,function(){return l[v++]})),u.name="Invariant Violation"}throw u.framesToPop=1,u}},se=ne;function ie(r){return se(r.rules&&r.rules.length>=0,"there is no valid rules list in the rules API response"),r.rules.map((i,n)=>({...i,id:n}))}async function ae(r,i){let n={rules:[]};try{const{url:s,init:t}=b(i),e=await fetch(s+r,t);e.ok&&(n=await e.json())}catch(s){console.log("failed to fetch rules",s)}return ie(n)}const x=F({key:"ruleFilterText",default:""});function oe(r,i){const n=g(),{mutate:s,isLoading:t}=M(S,{onSuccess:()=>{n.invalidateQueries("/providers/rules")}});return[a=>{a.preventDefault(),s({name:r,apiConfig:i})},t]}function ue(r){const i=g(),{data:n}=N(r),{mutate:s,isLoading:t}=M(re,{onSuccess:()=>{i.invalidateQueries("/providers/rules")}});return[a=>{a.preventDefault(),s({names:n.names,apiConfig:r})},t]}function N(r){return O(["/providers/rules",r],()=>te("/providers/rules",r))}function le(r){const{data:i,isFetching:n}=O(["/rules",r],()=>ae("/rules",r)),{data:s}=N(r),[t]=L(x);if(t==="")return{rules:i,provider:s,isFetching:n};{const e=t.toLowerCase();return{rules:i.filter(a=>a.payload.toLowerCase().indexOf(e)>=0),isFetching:n,provider:{byName:s.byName,names:s.names.filter(a=>a.toLowerCase().indexOf(e)>=0)}}}}const ce="_RuleProviderItem_12aid_1",de="_left_12aid_7",fe="_middle_12aid_14",he="_gray_12aid_21",me="_action_12aid_25",ve="_refreshBtn_12aid_32";var f={RuleProviderItem:ce,left:de,middle:fe,gray:he,action:me,refreshBtn:ve};function pe({idx:r,name:i,vehicleType:n,behavior:s,updatedAt:t,ruleCount:e,apiConfig:a}){const[d,u]=oe(i,a),l=J(new Date(t),new Date);return c("div",{className:f.RuleProviderItem,children:[o("span",{className:f.left,children:r}),c("div",{className:f.middle,children:[o(q,{name:i,type:`${n} / ${s}`}),o("div",{className:f.gray,children:e<2?`${e} rule`:`${e} rules`}),c("div",{className:f.action,children:[c(D,{onClick:d,disabled:u,className:f.refreshBtn,children:[o(C,{isRotating:u,size:13}),o("span",{className:"visually-hidden",children:"Refresh"})]}),c("small",{className:f.gray,children:["Updated ",l," ago"]})]})]})]})}function Re({apiConfig:r}){const[i,n]=ue(r),{t:s}=I();return o(K,{icon:o(C,{isRotating:n}),text:s("update_all_rule_provider"),style:X,onClick:i})}const ye="_rule_1ymqx_1",_e="_left_1ymqx_12",ge="_a_1ymqx_19",be="_b_1ymqx_26",Pe="_type_1ymqx_37";var m={rule:ye,left:_e,a:ge,b:be,type:Pe};const y={_default:"#59caf9",DIRECT:"#f5bc41",REJECT:"#cb3166"};function we({proxy:r}){let i=y._default;return y[r]&&(i=y[r]),{color:i}}function Oe({type:r,payload:i,proxy:n,id:s}){const t=we({proxy:n});return c("div",{className:m.rule,children:[o("div",{className:m.left,children:s}),c("div",{children:[o("div",{className:m.b,children:i}),c("div",{className:m.a,children:[o("div",{className:m.type,children:r}),o("div",{style:t,children:n})]})]})]})}const Ie="_header_1j1w3_1",Ce="_RuleProviderItemWrapper_1j1w3_17";var E={header:Ie,RuleProviderItemWrapper:Ce};const{memo:Me}=V,P=30;function Se(r,{rules:i,provider:n}){const s=n.names.length;return r<s?n.names[r]:i[r-s].id}function xe({provider:r}){return function(n){const s=r.names.length;return n<s?110:80}}const Ne=Me(({index:r,style:i,data:n})=>{const{rules:s,provider:t,apiConfig:e}=n,a=t.names.length;if(r<a){const u=t.names[r],l=t.byName[u];return o("div",{style:i,className:E.RuleProviderItemWrapper,children:o(pe,{apiConfig:e,...l})})}const d=s[r-a];return o("div",{style:i,children:o(Oe,{...d})})},W),Ee=r=>({apiConfig:j(r)});var qe=Q(Ee)(ke);function ke({apiConfig:r}){const[i,n]=Y(),{rules:s,provider:t}=le(r),e=xe({provider:t}),{t:a}=I();return c("div",{children:[c("div",{className:E.header,children:[o(z,{title:a("Rules")}),o(G,{placeholder:"Filter",textAtom:x})]}),o("div",{ref:i,style:{paddingBottom:P},children:o(H,{height:n-P,width:"100%",itemCount:s.length+t.names.length,itemSize:e,itemData:{rules:s,provider:t,apiConfig:r},itemKey:Se,children:Ne})}),t&&t.names&&t.names.length>0?o(Re,{apiConfig:r}):null]})}export{qe as default};
